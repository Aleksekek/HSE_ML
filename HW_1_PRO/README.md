# **Домашнее задание №1 (pro)**

В ходе работы исследовался датафрейм с данными про характеристики автомобилей.
Первые 5 строк загруженного датафрейма:

| name                              | year | selling_price | km_driven | fuel   | seller_type | transmission | owner         | mileage     | engine   | max_power  | torque                        | seats |
|:----------------------------------|:-----|:--------------|:----------|:-------|:------------|:-------------|:--------------|:------------|:---------|:-----------|:------------------------------|:------|
| Maruti Swift Dzire VDI            | 2014 | 450000        | 145500    | Diesel | Individual  | Manual       | First Owner   | 23.4 kmpl   | 1248 CC  | 74 bhp     | 190Nm@ 2000rpm                | 5.0   |
| Skoda Rapid 1.5 TDI Ambition      | 2014 | 370000        | 120000    | Diesel | Individual  | Manual       | Second Owner  | 21.14 kmpl  | 1498 CC  | 103.52 bhp | 250Nm@ 1500-2500rpm        | 5.0   |
| Hyundai i20 Sportz Diesel         | 2010 | 225000        | 127000    | Diesel | Individual  | Manual       | First Owner   | 23.0 kmpl   | 1396 CC  | 90 bhp     | 22.4 kgm at 1750-2750rpm      | 5.0   |
| Maruti Swift VXI BSIII            | 2007 | 130000        | 120000    | Petrol | Individual  | Manual       | First Owner   | 16.1 kmpl   | 1298 CC  | 88.2 bhp   | 11.5@ 4,500(kgm@ rpm)         | 5.0   |
| Hyundai Xcent 1.2 VTVT E Plus     | 2017 | 440000        | 45000     | Petrol | Individual  | Manual       | First Owner   | 20.14 kmpl  | 1197 CC  | 81.86 bhp  | 113.75nm@ 4000rpm             | 5.0   |

## **EDA**
   * Данные предобработаны (заполнены пропуски, удалены дубликаты, колонки приведены в числовой формат)
   * Изучены основные характеристики 
   * Проведена визуализация

## **Построение линейной модели**
   * Линейная регрессия, обученная только на числовых столбцах, получила точность 0.59 на тестовых данных по метрике $R^2$
   * Линейная и Lasso регрессии с нормированием признаков получили такой же скор
   * ElasticNet с перебором гиперпараметров получила итоговый скор 0.57 по $R^2$
   * Линейная регрессия с L0 получила 0.59 по $R^2$
   Таким образом, разные виды регуляризации не позволили улучшить точность модели, а также практически никак не повлияли на конечную важность признаков.

## **Добавление категориальных фичей**
   * Добавление категориальных фичей производилось при промощи OneHotEncoder'а
   * Ridge регрессия с категориальными фичами получила значительно лучшую точность - 0.78 по $R^2$
   Добавление категориальных фичей позволило значительно улучшить предиктивную способность линейных моделей.

## **Feature Engineering**
   * В рамках feature engineering'а были добавлены следующие группы признаков:
       * Квадраты, синусоиды и логарифмы основных числовых признаков
       * Произведения и их квадраты для некоторых признаков между собой
       * Для обработки названий автомобилей был выделен их производитель и на основании производителя дополнительно указывалась страна этого производителя
   * Для целевой переменной было принято решение применить логарифмирование для улучшения распределения
   Произведенные преобразования улучшили конечную точность ElasticNet модели с подбором параметров до 0.83 по $R^2$.

## **Бизнесовые метрики**
   * Исходная бизнес метрика оценивала процент предсказаний, отличающихся от фактического значения не более чем на 10%. Лучшая модель получила на этой метрике оценку 0.34
   * Созданная дополнительно бизнес метрика оценивает отклонения с учетом знака - предсказания менее фактических значений имеют экспоненциально увеличенный штраф. По этой метрике лучшая модель набрала 0.72, т.е. достаточно хорошо справляется по мерке бизнес требований.
 
## **Streamlit приложение**
   * Разработано стримлит приложение, содержащее:
       * Блок EDA с графиками
       * Блок прогнозирования, позволяющий загрузить туда собственные данные и сохранить результаты
       * Визуализацию коэффициентов лучшей модели
   * Запуск приложения:
   ```bash
   streamlit run app.py
   ```
   * ВАЖНО: запускать необходимо из директории HW_1_PRO, чтобы не возникло проблем с путями к моделям и визуализации внутри приложения

# **Результаты**

   * Конечный скор 0.83 по метрике $R^2$. Это значит что модель объясняет примерно 83% дисперсии в данных. Это достаточно хороший результат на непростых данных для линейной модели.
   * Регуляризация в основном бейзлайне оказывает достаточно низкое (близкое к нулевому) влияние на обучение. Вероятно, это связано со спецификой самих данных и часть фичей действительно настолько важнее, что эта важность превышает штраф регуляризации.
   * Наибольший прирост качества дало добавление категориальных фичей. Именно в этот момент произошел резкий скачок метрики с 0.59 до 0.78. Feature engineering дал прирост, но не настолько значимый.
   * Итоговый разработанный сервис получился достаточно простым, но охватывает все основные моменты проекта - от графиков из EDA до предсказания и визуализации важности признаков. Сложнее всего было корректно реализовать скачивание полученных предсказаний в виде датафрейма, поскольку для этого стримлиту нужны дополнительные преобразования датафрейма. Но в конечном счете и эта проблема была побеждена! :D